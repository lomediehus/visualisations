let alla_kommuner = ['Skellefteå', 'Degerfors', 'Forshaga', 'Lund', 'Hudiksvall', 'Gävle', 'Vetlanda', 'Avesta', 'Västerås', 'Älmhult', 'Härryda', 'Piteå', 'Stockholm', 'Gagnef', 'Danderyd', 'Kalmar', 'Värmdö', 'Norrköping', 'Linköping', 'Örnsköldsvik', 'Dorotea', 'Östersund', 'Arvika', 'Söderköping', 'Helsingborg', 'Hylte', 'Sollentuna', 'Ovanåker', 'Karlstad', 'Timrå', 'Finspång', 'Sundbyberg', 'Åre', 'Karlshamn', 'Hallstahammar', 'Krokom', 'Håbo', 'Skövde', 'Oskarshamn', 'Kävlinge', 'Vaxholm', 'Ystad', 'Jönköping', 'Halmstad', 'Ljungby', 'Bjuv', 'Örebro', 'Ekerö', 'Ronneby', 'Sigtuna', 'Hässleholm', 'Landskrona', 'Mölndal', 'Hagfors', 'Eksjö', 'Motala', 'Nacka', 'Mariestad', 'Härnösand', 'Katrineholm', 'Nykvarn', 'Nyköping', 'Borås', 'Mjölby', 'Lidingö', 'Täby', 'Orust', 'Emmaboda', 'Flen', 'Bräcke', 'Sölvesborg', 'Öckerö', 'Härjedalen', 'Gnesta', 'Södertälje', 'Falun', 'Göteborg', 'Botkyrka', 'Umeå', 'Eskilstuna', 'Eslöv', 'Nora', 'Sundsvall', 'Högsby', 'Fagersta', 'Falkenberg', 'Karlskrona', 'Norrtälje', 'Filipstad', 'Solna', 'Laxå', 'Falköping', 'Lekeberg', 'Uppvidinge', 'Lerum', 'Laholm', 'Vellinge', 'Enköping', 'Lindesberg', 'Kramfors', 'Värnamo', 'Bromölla', 'Nynäshamn', 'Säter', 'Uppsala', 'Tingsryd', 'Kristianstad', 'Järfälla', 'Kungsbacka', 'Vänersborg', 'Huddinge', 'Partille', 'Mönsterås', 'Lomma', 'Tyresö', 'Mora', 'Lycksele', 'Nässjö', 'Mark', 'Tierp', 'Borlänge', 'Ulricehamn', 'Ludvika', 'Ängelholm', 'Östhammar', 'Kiruna', 'Kil', 'Essunga', 'Sjöbo', 'Ånge', 'Kristinehamn', 'Färgelanda', 'Ljusdal', 'Mörbylånga', 'Växjö', 'Grums', 'Lidköping', 'Västervik', 'Luleå', 'Hedemora', 'Gislaved', 'Sollefteå', 'Östra Göinge', 'Nordanstig', 'Gnosjö', 'Gotland', 'Kungsör', 'Trelleborg', 'Tanum', 'Båstad', 'Alvesta', 'Arboga', 'Valdemarsvik', 'Alingsås', 'Grästorp', 'Haninge', 'Torsås', 'Gullspång', 'Gällivare', 'Bollnäs', 'Simrishamn', 'Herrljunga', 'Hammarö', 'Habo', 'Lilla Edet', 'Götene', 'Österåker', 'Berg', 'Kumla', 'Åstorp', 'Smedjebacken', 'Stenungsund', 'Hallsberg', 'Haparanda', 'Trollhättan', 'Upplands Väsby', 'Ragunda', 'Sunne', 'Heby', 'Uddevalla', 'Vara', 'Svenljunga', 'Hjo', 'Staffanstorp', 'Hofors', 'Vaggeryd', 'Lessebo', 'Hultsfred', 'Sotenäs', 'Varberg', 'Svedala', 'Nybro', 'Hällefors', 'Ödeshög', 'Höganäs', 'Säffle', 'Vingåker', 'Tidaholm', 'Hörby', 'Höör', 'Älvdalen', 'Kalix', 'Leksand', 'Skurup', 'Jokkmokk', 'Olofström', 'Sandviken', 'Vallentuna', 'Karlsborg', 'Osby', 'Kinda', 'Karlskoga', 'Knivsta', 'Kungälv', 'Köping', 'Ljusnarsberg', 'Eda', 'Klippan', 'Mellerud', 'Svalöv', 'Tjörn', 'Nordmaling', 'Upplands-Bro', 'Malung-Sälen', 'Tranemo', 'Söderhamn', 'Storuman', 'Lysekil', 'Malå', 'Strängnäs', 'Markaryd', 'Mullsjö', 'Munkedal', 'Munkfors', 'Ale', 'Norberg', 'Boden', 'Burlöv', 'Norsjö', 'Ockelbo', 'Bollebygd', 'Orsa', 'Oxelösund', 'Pajala', 'Perstorp', 'Surahammar', 'Malmö', 'Robertsfors', 'Rättvik', 'Salem', 'Sala', 'Skara', 'Strömstad', 'Skinnskatteberg', 'Älvkarleby', 'Sorsele', 'Sävsjö', 'Vimmerby', 'Storfors', 'Torsby', 'Trosa', 'Ydre', 'Strömsund', 'Tibro', 'Tomelilla', 'Årjäng', 'Tranås', 'Vadstena', 'Töreboda', 'Vindeln', 'Vansbro', 'Vilhelmina', 'Vårgårda', 'Vännäs', 'Åmål', 'Askersund', 'Åsele', 'Åtvidaberg', 'Älvsbyn', 'Örkelljunga', 'Överkalix', 'Övertorneå', 'Aneby', 'Arjeplog', 'Arvidsjaur', 'Bengtsfors', 'Bjurholm', 'Borgholm', 'Boxholm', 'Dals-Ed'];
informHeight();
let kommunhtml = document.getElementById("select-kommun");

alla_kommuner.forEach((kommun) => {
    let para = document.createElement("option");
    para.setAttribute('value', kommun)
    let node = document.createTextNode(kommun);
    para.appendChild(node);
    kommunhtml.appendChild(para);
}
)

// fetchData(kommun)
let map;

function initiateMap() {
    
    map = L.map('map', {zoomControl: false}).setView([62.23, 16.19], 13).setZoom(5);

    L.control.zoom({
        position: 'bottomleft'
    }).addTo(map);

    let tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);


    informHeight()


var eventHandler = function(name) {

	return function() {
		let kommun = arguments[0].toLowerCase();
        kommun = kommun.replace("ö","o")
        kommun = kommun.replace("å", "a")
        kommun = kommun.replace("ä", "a")
        fetchData(kommun);
	};
};

new TomSelect("#select-kommun",{
	create: false,
    addPrecedence: false,
    onChange: eventHandler('onChange'),
	sortField: {
		field: "text",
		direction: "asc",  
	},
    maxItems: 1
});


async function fetchData(kommun) {
    let url = "https://lomediehus.github.io/visualisations/arbetet_inkomstklyftor_karta/kommuner/" + kommun + ".json"
    let x = await fetch(url);
    let y = await x.text();
    y = JSON.parse(y);
    updateMap(y);
    informHeight();
  }



}

initiateMap()

//